<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>24 Game</title>
  <style>
    :root {
      --bg: #0b0f14;
      --bg-soft: #10161d;
      --card: #131a22;
      --card-edge: #1f2a36;
      --text: #e6edf3;
      --muted: #8ea1b2;
      --accent: #4f86ff;
      --accent-2: #19d3da;
      --danger: #ff6b6b;
      --ok: #7dffb3;
      --shadow: rgba(0,0,0,.5);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 50% -10%, #10161d, var(--bg));
      color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
      display: grid; place-items: center; padding: 24px;
    }

    .app { width: 100%; max-width: 920px; display: grid; gap: 18px; }

    header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      background: linear-gradient(180deg, #0f141b 0%, #0b0f14 100%);
      border: 1px solid #1a2330; padding: 14px 16px; border-radius: 14px;
      box-shadow: 0 10px 30px var(--shadow), inset 0 1px 0 rgba(255,255,255,.03);
    }
    header h1 { font-size: 20px; margin: 0; letter-spacing: .4px; font-weight: 650; }

    .actions { display:flex; gap:10px; flex-wrap: wrap; }
    .btn {
      appearance: none; border: 1px solid #213247; background: #0f1520; color: var(--text);
      padding: 10px 14px; border-radius: 12px; font-weight: 600; cursor: pointer;
      transition: transform .05s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
    }
    .btn:hover { border-color: #2b405a; box-shadow: 0 10px 26px rgba(0,0,0,.45); }
    .btn:active { transform: translateY(1px) scale(.99); }
    .btn.primary { background: linear-gradient(180deg, #183152, #12263d); border-color: #214167; }
    .btn.accent { background: linear-gradient(180deg, #2a3b66, #203054); border-color: #39528a; }

    .table {
      background: linear-gradient(180deg, var(--bg-soft), #0e141b);
      border: 1px solid #1a2330; border-radius: 16px; padding: 28px; display: grid;
      gap: 18px; box-shadow: inset 0 1px 0 rgba(255,255,255,.025), 0 20px 50px rgba(0,0,0,.55);
    }

    .cards { display: grid; grid-template-columns: repeat(4, minmax(90px, 1fr)); gap: 16px; place-items: center; }

    .card {
      width: 100%; aspect-ratio: 5/7; background: radial-gradient(280px 200px at 50% 20%, #1b2633 0%, #0f1621 70%);
      border-radius: 16px; border: 1px solid var(--card-edge); color: var(--text);
      display: grid; place-items: center; position: relative; isolation: isolate;
      box-shadow: 0 14px 40px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.04);
      transform: translateY(0); transition: transform .2s ease, box-shadow .2s ease;
    }
    .card:hover { transform: translateY(-3px); box-shadow: 0 18px 50px rgba(0,0,0,.66); }

    .pip { font-size: clamp(34px, 6vw, 44px); font-weight: 800; letter-spacing: .5px; }
    .label { position: absolute; left: 10px; top: 8px; font-weight: 700; color: var(--muted); font-size: 14px; }

    .io { display: grid; gap: 10px; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }

    input[type="text"] {
      width: 100%; background: #0f1520; color: var(--text);
      border: 1px solid #1f2b3b; border-radius: 12px; padding: 12px 14px; font-size: 15px;
      outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
    }
    input[type="text"]:focus { border-color: #33537a; box-shadow: 0 0 0 2px rgba(79,134,255,.15); }

    .status { padding: 12px 14px; border-radius: 12px; border: 1px solid #1f2b3b; background: #0f1520; min-height: 46px; }
    .status.ok { border-color: rgba(125,255,179,.35); }
    .status.err { border-color: rgba(255,107,107,.35); }

    footer { color: var(--muted); font-size: 13px; text-align: center; opacity: .9; }

    @media (max-width: 560px) {
      .cards { grid-template-columns: repeat(2, minmax(90px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>24 Game</h1>
      <div class="actions">
        <button id="regen" class="btn primary">Regenerate</button>
        <button id="toggle" class="btn">Toggle Labels</button>
        <button id="solve" class="btn">Get Hint</button>
      </div>
    </header>

    <section class="table">
      <div id="cards" class="cards" aria-live="polite"></div>

      <div class="io">
        <div class="row">
          <input id="expr" type="text" placeholder="Type your expression, e.g. (6/(1-3/4))" aria-label="Your expression" />
          <button id="check" class="btn accent">Check</button>
        </div>
        <div id="status" class="status" aria-live="polite"></div>
      </div>
    </section>

    <footer>Use numbers exactly once. Allowed operators: + − × ÷ and parentheses. A=1, J=11, Q=12, K=13.</footer>
  </div>

  <script>
    const API = "http://127.0.0.1:8000";
    let useFaceCards = true;
    let currentNums = [];

    const rankToLabel = (n) => ({11:'J',12:'Q',13:'K',1:'A'}[n] || String(n));

    function renderCards(nums) {
      currentNums = nums;
      const container = document.getElementById('cards');
      container.innerHTML = '';
      nums.forEach((n, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-value', n);
        const label = useFaceCards ? rankToLabel(n) : String(n);
        card.innerHTML = `
          <div class="label">#${idx+1}</div>
          <div class="pip">${label}</div>
        `;
        container.appendChild(card);
      });
    }

    function fillInputsFromCards() {
      return currentNums;
    }

    function setStatus(text, ok=null) {
      const el = document.getElementById('status');
      el.textContent = text;
      el.classList.remove('ok','err');
      if (ok === true) el.classList.add('ok');
      if (ok === false) el.classList.add('err');
    }

    async function newPuzzle() {
      setStatus('Generating puzzle…');
      const res = await fetch(`${API}/puzzle?solvable=true`);
      const json = await res.json();
      renderCards(json.nums);
      setStatus('New hand dealt. Good luck!');
    }

    async function checkExpression() {
      const nums = fillInputsFromCards();
      const expression = document.getElementById('expr').value.trim();
      if (!expression) { setStatus('Enter an expression to check.'); return; }
      setStatus('Checking…');
      const res = await fetch(`${API}/check`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nums, expression })
      });
      const json = await res.json();
      setStatus((json.ok ? '✅ ' : '❌ ') + json.message, json.ok);
    }

    async function getHint() {
      const nums = fillInputsFromCards();
      setStatus('Looking for a hint…');
      const res = await fetch(`${API}/solve`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nums })
      });
      const json = await res.json();
      if (json.expression) {
        const hint = json.expression.replace(/\s+/g, ' ');
        setStatus('Hint: ' + hint);
      } else {
        setStatus('No solution for this hand. Try Regenerate.', false);
      }
    }

    function toggleLabels() {
      useFaceCards = !useFaceCards;
      renderCards(currentNums);
    }

    document.getElementById('regen').addEventListener('click', newPuzzle);
    document.getElementById('toggle').addEventListener('click', toggleLabels);
    document.getElementById('check').addEventListener('click', checkExpression);
    document.getElementById('solve').addEventListener('click', getHint);
    document.getElementById('expr').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); checkExpression(); }
    });

    newPuzzle();
  </script>
</body>
</html>